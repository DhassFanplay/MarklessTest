<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>OpenCV Plane Detection</title>
  <style>
    video, canvas {
      width: 100vw;
      height: 100vh;
      object-fit: cover;
    }
  </style>
</head>
<body>

<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>

<script async src="https://docs.opencv.org/4.5.0/opencv.js "></script>
<script>
  const video = document.getElementById('video');
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');

  // Get video stream
  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => {
      video.srcObject = stream;
      requestAnimationFrame(processFrame);
    });

  function processFrame() {
    // Resize canvas to match video size
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;

    // Draw current video frame to canvas
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    // Get image data
    let src = cv.imread(canvas);
    let gray = new cv.Mat();
    let edges = new cv.Mat();

    // Convert to grayscale
    cv.cvtColor(src, gray, cv.COLOR_RGBA2GRAY);

    // Edge detection
    cv.Canny(gray, edges, 50, 150);

    // Find contours
    let contours = new cv.MatVector();
    let hierarchy = new cv.Mat();
    cv.findContours(edges, contours, hierarchy, cv.RETR_EXTERNAL, cv.CHAIN_APPROX_SIMPLE);

    // Draw contours (basic plane-like detection)
    for (let i = 0; i < contours.size(); ++i) {
      let cnt = contours.get(i);
      if (cv.contourArea(cnt) > 1000) {
        cv.drawContours(src, contours, i, [0, 255, 0, 255], 2);
      }
    }

    // Show result
    cv.imshow('canvas', src);

    // Cleanup
    src.delete(); gray.delete(); edges.delete(); contours.delete(); hierarchy.delete();

    requestAnimationFrame(processFrame);
  }
</script>
</body>
</html>
